<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ title or 'DhanSetu' }}</title>
  <link rel="stylesheet" href="/static/css/style.css" />
</head>
<body class="theme-corporate">
  <nav class="nav">
    <div class="brand">
      <span class="brand-text">Dhan<span>Setu</span></span>
    </div>
    <button class="nav-toggle" id="nav-toggle" aria-label="Toggle navigation" aria-expanded="false">☰</button>
    <div class="links">
      <a href="/">Home</a>
      <a href="/loan">Loan</a>
      <a href="/kyc">KYC</a>
      <a href="/chat" id="nav-chat-link">Chat</a>
      {% if current_user.is_authenticated %}
        <a href="/user-dashboard">My Dashboard</a>
      {% endif %}
      <div class="dropdown">
        <a href="#" class="dropdown-toggle">Account ▾</a>
        <div class="dropdown-menu">
          <a href="/login">User Login</a>
          <a href="/register">User Sign Up</a>
        </div>
      </div>
    </div>
  </nav>
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="container" style="margin-top:12px">
        {% for category, message in messages %}
          <div style="padding:10px 12px; border:1px solid rgba(255,255,255,.2); background: rgba(124,58,237,.15); color:#fff; margin-bottom:8px">{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}
  <main class="container">
    {% block content %}{% endblock %}
  </main>
  <footer class="footer-columns">
    <div class="container footer-grid">
      <div class="col">
        <h4>Main Office</h4>
        <p>DhanSetu HQ<br/>123 Finance Park<br/>Mumbai, MH 400001</p>
        <p>Mon–Fri, 9:00–18:00</p>
      </div>
      <div class="col">
        <h4>Customer Support</h4>
        <ul>
          <li><a href="#">Help Center</a></li>
          <li><a href="#">Contact Us</a></li>
          <li><a href="#">Status</a></li>
        </ul>
      </div>
      <div class="col">
        <h4>Legal</h4>
        <ul>
          <li><a href="#">Terms of Service</a></li>
          <li><a href="#">Privacy Policy</a></li>
          <li><a href="#">Cookie Settings</a></li>
        </ul>
      </div>
      <div class="col">
        <h4>Related Links</h4>
        <ul>
          <li><a href="#">About</a></li>
          <li><a href="#">Banker Portal</a></li>
          <li><a href="#">KYC</a></li>
        </ul>
      </div>
    </div>
    <div class="container foot-bar">
      <div>© {{ (now or '') if false else '' }} DhanSetu • All rights reserved</div>
      <div class="links">
        <a href="/">Home</a>
        <a href="/loan">Loan</a>
        <a href="/kyc">KYC</a>
        <a href="/banker">Banker</a>
      </div>
    </div>
  </footer>
  {% block chat_widget %}
  <!-- Chatbot widget -->
  <div id="chatbot" class="chatbot" aria-live="polite">
    <button id="chatbot-toggle" class="chat-toggle" aria-expanded="false" aria-controls="chatbot-panel">Chat</button>
    <div id="chatbot-panel" class="chat-panel" hidden>
      <div class="chat-header">
        <strong>Ask DhanSetu</strong>
        <button id="chatbot-close" class="chat-close" aria-label="Close chat">×</button>
      </div>
      <div id="chatbot-messages" class="chat-messages"></div>
      <form id="chatbot-form" class="chat-input" autocomplete="off">
        <input id="chatbot-text" name="message" type="text" placeholder="Ask about loans, KYC, EMI..." required />
        <button type="submit" class="btn">Send</button>
      </form>
    </div>
  </div>
  {% endblock %}
  <script src="/static/js/app.js"></script>
  <script>
    (function(){
      const btn = document.getElementById('nav-toggle');
      const links = document.querySelector('.nav .links');
      if(btn && links){
        btn.addEventListener('click', ()=>{
          const open = links.classList.toggle('open');
          btn.setAttribute('aria-expanded', open ? 'true' : 'false');
        });
      }
    })();
  </script>
  {% block scripts %}{% endblock %}
</body>
</html>
